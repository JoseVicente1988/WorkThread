generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  username     String        @unique
  email        String        @unique
  passwordHash String
  bio          String        @default("")
  skills       String        @default("")
  createdAt    DateTime      @default(now())
  posts        Post[]
  feedbacks    Feedback[]
  comments     Comment[]
  following    Follow[]      @relation("following")
  followers    Follow[]      @relation("followers")
  jobs         Job[]         @relation("JobPostedBy")
  applications Application[]
  savedJobs    SavedJob[]
}

model Post {
  id        String     @id @default(cuid())
  authorId  String
  content   String
  tags      String     @default("")
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  author    User       @relation(fields: [authorId], references: [id])
  feedbacks Feedback[]
  comments  Comment[]
}

enum FeedbackType {
  LIKE
  INSIGHT
  QUESTION
  HIRE_ME
  REFER
}

model Feedback {
  id        String       @id @default(cuid())
  postId    String
  authorId  String
  type      FeedbackType
  content   String       @default("")
  createdAt DateTime     @default(now())
  post      Post         @relation(fields: [postId], references: [id])
  author    User         @relation(fields: [authorId], references: [id])

  @@index([postId, type])
}

model Comment {
  id        String   @id @default(cuid())
  postId    String
  authorId  String
  content   String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id])
  author    User     @relation(fields: [authorId], references: [id])

  @@index([postId, createdAt])
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())
  follower    User     @relation("followers", fields: [followerId], references: [id])
  following   User     @relation("following", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
}

model Job {
  id           String        @id @default(cuid())
  title        String
  company      String
  location     String        @default("Remote")
  remote       Boolean       @default(true)
  minSalary    Int?
  maxSalary    Int?
  currency     String        @default("USD")
  skills       String        @default("")
  description  String
  postedById   String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  postedBy     User          @relation("JobPostedBy", fields: [postedById], references: [id])
  applications Application[]
  savedBy      SavedJob[]

  @@index([title, company])
  @@index([location, remote])
}

model Application {
  id        String    @id @default(cuid())
  jobId     String
  userId    String
  message   String    @default("")
  status    AppStatus @default(PENDING)
  createdAt DateTime  @default(now())
  job       Job       @relation(fields: [jobId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([jobId, userId])
}

enum AppStatus {
  PENDING
  REVIEWING
  REJECTED
  INTERVIEW
  OFFER
  HIRED
}

model SavedJob {
  id        String   @id @default(cuid())
  jobId     String
  userId    String
  createdAt DateTime @default(now())
  job       Job      @relation(fields: [jobId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([jobId, userId])
}
